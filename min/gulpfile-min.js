"use strict";var $=require("gulp-load-plugins")(),argv=require("yargs").argv,gulp=require("gulp"),browserSync=require("browser-sync").create(),merge=require("merge-stream"),sequence=require("run-sequence"),colors=require("colors"),dateFormat=require("dateformat"),del=require("del"),isProduction=!!argv.production,COMPATIBILITY=["last 2 versions","ie >= 9","Android >= 2.3"],PATHS={sass:["assets/components/foundation-sites/scss","assets/components/motion-ui/src","assets/components/fontawesome/scss"],javascript:["assets/components/what-input/what-input.js","assets/components/foundation-sites/js/foundation.core.js","assets/components/foundation-sites/js/foundation.util.*.js","assets/components/foundation-sites/js/foundation.abide.js","assets/components/foundation-sites/js/foundation.accordion.js","assets/components/foundation-sites/js/foundation.accordionMenu.js","assets/components/foundation-sites/js/foundation.drilldown.js","assets/components/foundation-sites/js/foundation.dropdown.js","assets/components/foundation-sites/js/foundation.dropdownMenu.js","assets/components/foundation-sites/js/foundation.equalizer.js","assets/components/foundation-sites/js/foundation.interchange.js","assets/components/foundation-sites/js/foundation.magellan.js","assets/components/foundation-sites/js/foundation.offcanvas.js","assets/components/foundation-sites/js/foundation.orbit.js","assets/components/foundation-sites/js/foundation.responsiveMenu.js","assets/components/foundation-sites/js/foundation.responsiveToggle.js","assets/components/foundation-sites/js/foundation.reveal.js","assets/components/foundation-sites/js/foundation.slider.js","assets/components/foundation-sites/js/foundation.sticky.js","assets/components/foundation-sites/js/foundation.tabs.js","assets/components/foundation-sites/js/foundation.toggler.js","assets/components/foundation-sites/js/foundation.tooltip.js","assets/components/motion-ui/motion-ui.js","assets/js/*.js"],phpcs:["**/*.php","!wpcs","!wpcs/**"],pkg:["**/*","!**/node_modules/**","!**/components/**","!**/scss/**","!**/bower.json","!**/gulpfile.js","!**/package.json","!**/composer.json","!**/composer.lock","!**/codesniffer.ruleset.xml","!**/packaged/*"]};gulp.task("browser-sync",["build"],function(){var s=["**/*.php","assets/images/**/*.{png,jpg,gif}"];browserSync.init(s,{proxy:""})}),gulp.task("sass",function(){var s=$.if(isProduction,$.minifyCss());return gulp.src("assets/scss/app.scss").pipe($.sourcemaps.init()).pipe($.sass({includePaths:PATHS.sass})).on("error",$.notify.onError({message:"<%= error.message %>",title:"Sass Error"})).pipe($.autoprefixer({browsers:COMPATIBILITY})).pipe(s).pipe($.if(!isProduction,$.sourcemaps.write("."))).pipe(gulp.dest("assets/css")).pipe(browserSync.stream({match:"**/*.css"}))}),gulp.task("lint",function(){return gulp.src("assets/js/*.js").pipe($.jshint()).pipe($.notify(function(s){if(s.jshint.success)return!1;var e=s.jshint.results.map(function(s){if(s.error)return"("+s.error.line+":"+s.error.character+") "+s.error.reason}).join("\n");return s.relative+" ("+s.jshint.results.length+" errors)\n"+e}))}),gulp.task("javascript",function(){var s=$.uglify().on("error",$.notify.onError({message:"<%= error.message %>",title:"Uglify JS Error"}));return gulp.src(PATHS.javascript).pipe($.sourcemaps.init()).pipe($.babel()).pipe($.concat("foundation.js",{newLine:"\n;"})).pipe($.if(isProduction,s)).pipe($.if(!isProduction,$.sourcemaps.write())).pipe(gulp.dest("assets/js")).pipe(browserSync.stream())}),gulp.task("copy",function(){return merge(gulp.src("assets/components/motion-ui/**/*.*").pipe($.flatten()).pipe(gulp.dest("assets/js/vendor/motion-ui")),gulp.src("assets/components/what-input/**/*.*").pipe($.flatten()).pipe(gulp.dest("assets/js/vendor/what-input")),gulp.src("assets/components/fontawesome/fonts/**/*.*").pipe(gulp.dest("assets/fonts")))}),gulp.task("package",["build"],function(){var s=require("fs"),e=dateFormat(new Date,"yyyy-mm-dd_HH-MM"),n=JSON.parse(s.readFileSync("./package.json")),o=n.name+"_"+e+".zip";return gulp.src(PATHS.pkg).pipe($.zip(o)).pipe(gulp.dest("packaged"))}),gulp.task("build",["clean"],function(s){sequence("copy",["sass","javascript","lint"],s)}),gulp.task("phpcs",function(){return gulp.src(PATHS.phpcs).pipe($.phpcs({bin:"wpcs/vendor/bin/phpcs",standard:"./codesniffer.ruleset.xml",showSniffCode:!0})).pipe($.phpcs.reporter("log"))}),gulp.task("phpcbf",function(){return gulp.src(PATHS.phpcs).pipe($.phpcbf({bin:"wpcs/vendor/bin/phpcbf",standard:"./codesniffer.ruleset.xml",warningSeverity:0})).on("error",$.util.log).pipe(gulp.dest("."))}),gulp.task("clean",function(s){sequence(["clean:javascript","clean:css"],s)}),gulp.task("clean:javascript",function(){return del(["assets/js/app.js"])}),gulp.task("clean:css",function(){return del(["assets/css/app.css","assets/css/app.css.map"])}),gulp.task("default",["build","browser-sync"],function(){function s(s){var e=require("path").relative(__dirname,s.path);console.log("["+"WATCH".green+"] "+e.magenta+" was "+s.type+", running tasks...")}gulp.watch(["assets/scss/**/*.scss"],["clean:css","sass"]).on("change",function(e){s(e)}),gulp.watch(["assets/js/**/*.js"],["clean:javascript","javascript","lint"]).on("change",function(e){s(e)})});